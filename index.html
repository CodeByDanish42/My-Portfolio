<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Blog App With Post</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
    }
    .card {
      background: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    input, textarea, button {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #0056b3;
    }
    .tag {
      display: inline-block;
      background: #e5e5e5;
      padding: 2px 6px;
      margin-right: 5px;
      border-radius: 4px;
      font-size: 12px;
    }
    .actions button {
      width: auto;
      margin-right: 8px;
    }
    .filter {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    #auth-section {
      max-width: 400px;
      margin: auto;
    }
    .toggle-auth {
      text-align: center;
      margin-top: 10px;
    }
    .logout {
      text-align: right;
      margin-bottom: 10px;
    }
    .logout button {
      background: red;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Auth Section -->
    <div id="auth-section" class="card">
      <h2 id="auth-title">Sign In</h2>
      <input type="text" id="auth-username" placeholder="Username">
      <input type="password" id="auth-password" placeholder="Password">
      <button onclick="handleAuth()">Sign In</button>
      <div class="toggle-auth">
        <p id="toggle-text">Don't have an account? <a href="#" onclick="toggleAuth()">Sign Up</a></p>
      </div>
    </div>

    <!-- Blog Section -->
    <div id="blog-section" style="display:none;">
      <div class="logout">
        <button onclick="logout()">Logout</button>
      </div>
      <h1>üìù Blog App</h1>

      <!-- Create/Edit Post -->
      <div class="card">
        <input type="hidden" id="edit-id">
        <input type="text" id="title" placeholder="Post title">
        <textarea id="content" rows="4" placeholder="Write your post..."></textarea>
        <input type="text" id="tags" placeholder="Tags (comma separated)">
        <button id="save-btn" onclick="addOrUpdatePost()">Add Post</button>
        <button id="cancel-edit" style="display:none; background:gray;" onclick="cancelEdit()">Cancel Edit</button>
      </div>

      <!-- Filters -->
      <div class="filter">
        <button onclick="setFilter('all')">All</button>
        <button onclick="setFilter('published')">Published</button>
        <button onclick="setFilter('draft')">Drafts</button>
      </div>

      <!-- Posts List -->
      <div id="posts"></div>
    </div>
  </div>

  <script>
    let posts = [];
    let filter = "all";
    let isSignup = false;
    let currentUser = localStorage.getItem("currentUser");

    if (currentUser) {
      loadUserPosts();
      showBlog();
    }

    function toggleAuth() {
      isSignup = !isSignup;
      document.getElementById("auth-title").innerText = isSignup ? "Sign Up" : "Sign In";
      document.querySelector("#auth-section button").innerText = isSignup ? "Sign Up" : "Sign In";
      document.getElementById("toggle-text").innerHTML = isSignup
        ? `Already have an account? <a href="#" onclick="toggleAuth()">Sign In</a>`
        : `Don't have an account? <a href="#" onclick="toggleAuth()">Sign Up</a>`;
    }

    function handleAuth() {
      const username = document.getElementById("auth-username").value.trim();
      const password = document.getElementById("auth-password").value.trim();

      if (!username || !password) return alert("Fill all fields");

      let users = JSON.parse(localStorage.getItem("users") || "[]");

      if (isSignup) {
        if (users.find(u => u.username === username)) {
          return alert("Username already exists!");
        }
        users.push({ username, password });
        localStorage.setItem("users", JSON.stringify(users));
        alert("Signup successful! Please sign in.");
        toggleAuth();
      } else {
        const user = users.find(u => u.username === username && u.password === password);
        if (!user) return alert("Invalid credentials");
        localStorage.setItem("currentUser", username);
        currentUser = username;
        loadUserPosts();
        showBlog();
      }
    }

    function logout() {
      localStorage.removeItem("currentUser");
      currentUser = null;
      posts = [];
      document.getElementById("blog-section").style.display = "none";
      document.getElementById("auth-section").style.display = "block";
      location.reload(); // force refresh on logout
    }

    function showBlog() {
      document.getElementById("auth-section").style.display = "none";
      document.getElementById("blog-section").style.display = "block";
      renderPosts();
    }

    function loadUserPosts() {
      posts = JSON.parse(localStorage.getItem("posts_" + currentUser) || "[]");
    }

    function savePosts() {
      localStorage.setItem("posts_" + currentUser, JSON.stringify(posts));
    }

    function addOrUpdatePost() {
      const title = document.getElementById("title").value.trim();
      const content = document.getElementById("content").value.trim();
      const tags = document.getElementById("tags").value.split(",").map(t => t.trim()).filter(Boolean);
      const editId = document.getElementById("edit-id").value;

      if (!title) return alert("Title is required");

      if (editId) {
        posts = posts.map(p =>
          p.id == editId ? { ...p, title, content, tags } : p
        );
        document.getElementById("save-btn").innerText = "Add Post";
        document.getElementById("cancel-edit").style.display = "none";
        document.getElementById("edit-id").value = "";
      } else {
        const newPost = {
          id: Date.now(),
          title,
          content,
          tags,
          published: false,
          author: currentUser
        };
        posts.unshift(newPost);
      }

      savePosts();
      renderPosts();
      clearForm();
    }

    function editPost(id) {
      const post = posts.find(p => p.id === id);
      if (!post) return;

      document.getElementById("title").value = post.title;
      document.getElementById("content").value = post.content;
      document.getElementById("tags").value = post.tags.join(", ");
      document.getElementById("edit-id").value = post.id;
      document.getElementById("save-btn").innerText = "Update Post";
      document.getElementById("cancel-edit").style.display = "inline-block";
    }

    function cancelEdit() {
      clearForm();
      document.getElementById("save-btn").innerText = "Add Post";
      document.getElementById("cancel-edit").style.display = "none";
      document.getElementById("edit-id").value = "";
    }

    function clearForm() {
      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
      document.getElementById("tags").value = "";
    }

    function togglePublish(id) {
      posts = posts.map(p => p.id === id ? { ...p, published: !p.published } : p);
      savePosts();
      renderPosts();
    }

    function removePost(id) {
      posts = posts.filter(p => p.id !== id);
      savePosts();
      renderPosts();
    }

    function setFilter(f) {
      filter = f;
      renderPosts();
    }

    function renderPosts() {
      const container = document.getElementById("posts");
      container.innerHTML = "";

      let filtered = posts;
      if (filter === "published") {
        filtered = posts.filter(p => p.published);
      } else if (filter === "draft") {
        filtered = posts.filter(p => !p.published);
      }

      if (filtered.length === 0) {
        container.innerHTML = "<p>No posts yet.</p>";
        return;
      }

      filtered.forEach(post => {
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
          <h2>${post.title}</h2>
          <p>${post.content}</p>
          <div>${post.tags.map(tag => `<span class="tag">#${tag}</span>`).join(" ")}</div>
          <small><i>By: ${post.author}</i></small>
          <div class="actions">
            <button onclick="togglePublish(${post.id})">
              ${post.published ? "Unpublish" : "Publish"}
            </button>
            <button onclick="editPost(${post.id})" style="background:orange;">Edit</button>
            <button onclick="removePost(${post.id})" style="background:red;">Delete</button>
          </div>
        `;
        container.appendChild(card);
      });
    }
  </script>
</body>
</html>

